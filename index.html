<!DOCTYPE html>
<html>
<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    
    <title>lilei&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="lilei&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="lilei&#39;s blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="lilei&#39;s blog">
    

    
        <link rel="alternate" href="/" title="lilei&#39;s blog" type="application/atom+xml" />
    

    
        <link rel="icon" href="/images/favicon.ico" />
    

    <link rel="stylesheet" href="/libs/font-awesome5/css/fontawesome.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-brands.min.css">
    <link rel="stylesheet" href="/libs/font-awesome5/css/fa-solid.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    
    
    
    


</head>

<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">lilei&#39;s blog</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/shanks.png" />
                            <i class="fas fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fas fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile" class="profile-fixed">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/shanks.png" />
            <h2 id="name">lilei</h2>
            <h3 id="title">student &amp; manga lover</h3>
            <span id="location"><i class="fas fa-map-marker-alt" style="padding-right: 5px"></i>xi&#39;an, China</span>
            <a id="follow" target="_blank" href="https://github.com/scholar/">FOLLOW</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                13
                <span>posts</span>
            </div>
            <div class="article-info-block">
                4
                <span>tags</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/scholar" target="_blank" title="github" class=tooltip>
                            <i class="fab fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fab fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fab fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fab fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fab fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-2019-周报11" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/04/27/2019-周报11/">2019-周报11</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/04/27/2019-周报11/">
            <time datetime="2019-04-27T10:51:27.000Z" itemprop="datePublished">2019-04-27</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/ImageProcessing/">ImageProcessing</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周学习了VAE-GAN, B    iGAN等理论知识，针对之前说的利用GAN做unpaired的网络，阅读了论文<strong>Unsupervised Image Super-Resolution using Cycle-in-Cycle Generative Adversarial Networks</strong> 并进行了实现，由于实验室显卡使用紧张，训练了10个epoch，得到了不错的效果。同时，在FlyAI上报名了比赛，在事情较少的时候开始做做比赛，检验水平。</p>
<h1 id="1-CinCGAN"><a href="#1-CinCGAN" class="headerlink" title="1 CinCGAN"></a>1 CinCGAN</h1><p><strong>CinCGAN</strong>将去噪网络与超分网络结合，去噪部分使用cycleGAN的结构，将去噪后的结果输入训练之后的<strong>EDSR</strong> 超分网络得到超分图像，再通过一个生成网络生成低分辨带噪声图像与最初输入图像之间计算损失。整个网络结构相当于一个大的cycleGAN中再加入一个cycleGAN，所以起名为CinCGAN(cycle in cycle GAN)，网络共有三个Generator，两个Discriminator，一个EDSR，整体网络结构如下。</p>
<p><img src="/2019/04/27/2019-周报11/week11-CinCGAN.png" alt="图1.CinCGAN"></p>
<p>网络使用<strong>NTIRE2018 Super-Resolution Challenge</strong> 比赛提供的高清数据集DIV2K进行训练，其中包含800张训练图片和100张测试图片。其中低清图片直接使用 <strong>bicubic</strong> 下采用得到，噪声图片在下采样基础上加噪得到。并通过旋转，裁剪来扩张数据。</p>
<h3 id="1-1-网络结构"><a href="#1-1-网络结构" class="headerlink" title="1.1 网络结构"></a>1.1 网络结构</h3><p>上面提到网络共有三个Generator，两个Discriminator，一个EDSR。其中生成器与判别器的网络结构各自相同，如下图所示。</p>
<p><img src="/2019/04/27/2019-周报11/week11-DGstructure.png" alt="图2.生成器&amp;判别器结构"></p>
<h3 id="1-2-训练过程"><a href="#1-2-训练过程" class="headerlink" title="1.2 训练过程"></a>1.2 训练过程</h3><p>网络的训练主要分为两个部分单独训练，也即是网络中的两个cycleGAN。首先训练网络中的<strong>LR -&gt; clean LR</strong> 去噪网络，在去噪网络训练完成之后再训练整个大的超分网络。</p>
<ul>
<li>STEP1 (内部去噪网络)：<ol>
<li>从bicubic下采样训练集中取样m个(一个batch)样本作为real样本</li>
<li>从加噪训练集中取样m个样本，输入G1得到输出作为fake样本</li>
<li>使用real样本，fake样本更新判别器D1</li>
<li>G1网络输出张量输入判别器D1计算log损失函数 $LogLoss$</li>
<li>G1网络输入加噪图片，计算去噪之后的 $TVLoss$</li>
<li>G1网络输入bicubic下采样图片，计算输入前后的$L1loss$</li>
<li>计算G2网络的输出与G1网络输入之间的 $MSEloss$</li>
<li>总损失$ Loss = LogLoss + 0.5<em>TVLoss + 5</em> L1loss + 10*MSEloss$</li>
<li>更新生成器 G1 G2</li>
</ol>
</li>
<li>STEP2 (超分网络)：<ol>
<li>STEP1更新</li>
<li>从训练集中采样高清图m个作为real样本</li>
<li>EDSR输出作为fake样本</li>
<li>更新D2</li>
<li>EDSR网络输出张量输入判别器D2计算log损失函数 $LogLoss$</li>
<li>对EDSR网络输出张量计算 $TVLoss$</li>
<li>计算EDSR网络的输出与高清图片之间的 $MSELoss1 $</li>
<li>计算G3网络输出与G1网络输入之间的 $MSELoss2 $</li>
<li>总损失 $ Loss = LogLoss + 2<em>TVLoss + 5</em> L1loss + 10*MSEloss$</li>
<li>更新生成器 G1 G2 G3</li>
</ol>
</li>
</ul>
<h3 id="1-3-参考资料"><a href="#1-3-参考资料" class="headerlink" title="1.3 参考资料"></a>1.3 参考资料</h3><ul>
<li><a href="https://arxiv.org/pdf/1809.00437v1.pdf" target="_blank" rel="noopener">Unsupervised Image Super-Resolution using Cycle-in-Cycle Generative Adversarial Networks</a></li>
<li><a href="https://github.com/Junshk/CinCGAN-pytorch" target="_blank" rel="noopener">CinCGAN-pytorch</a></li>
</ul>
<h1 id="2-图像去锯齿"><a href="#2-图像去锯齿" class="headerlink" title="2 图像去锯齿"></a>2 图像去锯齿</h1><p>研究生阶段多数时间在学习深度学习的图像处理，传统的图像处理很少用过，看到这个小测试就很有兴趣。查阅书籍之后决定使用简单方法进行实现，实现步骤大概为以下三个步骤</p>
<ul>
<li>有锯齿区域提取 (ROI)</li>
<li>对锯齿区域模糊处理</li>
<li>对锯齿区域锐化</li>
</ul>
<h5 id="1-锯齿区域提取"><a href="#1-锯齿区域提取" class="headerlink" title="1. 锯齿区域提取"></a>1. 锯齿区域提取</h5><p><img src="/2019/04/27/2019-周报11/week11-AntiAliasing1.png" alt="图2.区域提取"></p>
<p>如上图所示，锯齿区域提取主要包括灰度提取，边缘提取，边缘筛选，膨胀扩大边缘区域四个部分。在测试过<strong>sobel</strong> 边缘提取，<strong>prewitt </strong>边缘提取，<strong>Laplasian of Gaussian</strong> 边缘提取，<strong>canny </strong>边缘提取之后，根据结果选择了<strong>canny</strong> 算子进行边缘提取。</p>
<h5 id="2-滤波锐化"><a href="#2-滤波锐化" class="headerlink" title="2.滤波锐化"></a>2.滤波锐化</h5><p>对上面提取的区域进行掩膜滤波，使用高斯模糊再进行<strong>sobel</strong> 锐化得到处理前后的对比图如下</p>
<p><img src="/2019/04/27/2019-周报11/week11-AntiAliasing6.png" alt="图3.结果对比"></p>
<p>附处理代码如下：</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">I_ori = imread(<span class="string">'4.png'</span>);     <span class="comment">% 读取图片</span></span><br><span class="line">I = I_ori(:,:,<span class="number">2</span>);</span><br><span class="line">imshow(I,[]);</span><br><span class="line"><span class="comment">%I = imbinarize(I);</span></span><br><span class="line"></span><br><span class="line">cannyBW=edge(I,<span class="string">'canny'</span>);      <span class="comment">% 边缘提取</span></span><br><span class="line">figure;</span><br><span class="line">imshow(cannyBW);</span><br><span class="line">title(<span class="string">'canny Edge'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Test</span></span><br><span class="line">p = regionprops(cannyBW, <span class="string">'Perimeter'</span>, <span class="string">'PixelIdxList'</span>);</span><br><span class="line"><span class="comment">%[test, longest] = max([p.Perimeter]);</span></span><br><span class="line">[~,Index] = sort([p.Perimeter],<span class="string">'descend'</span>);</span><br><span class="line"><span class="comment">%[~, longest] = max([p.Perimeter]);</span></span><br><span class="line">BW2 = <span class="built_in">zeros</span>(<span class="built_in">size</span>(cannyBW));</span><br><span class="line">SortLongestG = SortLongest(<span class="number">1</span>:<span class="number">20</span>);</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">i</span> = <span class="number">1</span>:<span class="number">10</span></span><br><span class="line">    <span class="comment">%j = int8(i);</span></span><br><span class="line">    <span class="built_in">j</span> = Index(<span class="built_in">i</span>);</span><br><span class="line">    PixelIdxList = p(<span class="built_in">j</span>).PixelIdxList;</span><br><span class="line">    BW2(PixelIdxList) = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">figure;</span><br><span class="line">imshow(BW2)</span><br><span class="line"></span><br><span class="line"><span class="comment">% logBW_dilate = imdilate(logBW, [1 1 1;1 1 1;1 1 1]);         % 提取 ROI </span></span><br><span class="line">logBW_dilate = imdilate(BW2, [<span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>;<span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span>;<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>;<span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span>;<span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span>]);</span><br><span class="line"><span class="comment">% logBW_dilate = imdilate(logBW, [1 1 1 1 1;1 1 1 1 1;1 1 1 1 1;1 1 1 1 1;1 1 1 1 1]);</span></span><br><span class="line"><span class="comment">% logBW_dilate = imdilate(logBW, [1 1 1 1 1;1 1 1 1 1;1 1 1 1 1]);</span></span><br><span class="line"><span class="comment">% logBW_dilate = imdilate(logBW, [1 1 1 1;1 1 1 1;1 1 1 1]);</span></span><br><span class="line"><span class="comment">% logBW_dilate = imdilate(logBW, [1 1;1 1;1 1;1 1;1 1;1 1]);</span></span><br><span class="line">figure;</span><br><span class="line">imshow(logBW_dilate);</span><br><span class="line">title(<span class="string">'dilate of Laplasian of canny Edge'</span>);</span><br><span class="line"></span><br><span class="line">G = fspecial(<span class="string">'gaussian'</span>, [<span class="number">5</span> <span class="number">5</span>], <span class="number">2</span>);        <span class="comment">% ROI 区域进行高斯模糊</span></span><br><span class="line">blurI = I_ori;</span><br><span class="line">blurI(:,:,<span class="number">1</span>) = roifilt2(G,I_ori(:,:,<span class="number">1</span>),logBW_dilate);</span><br><span class="line">blurI(:,:,<span class="number">2</span>) = roifilt2(G,I_ori(:,:,<span class="number">2</span>),logBW_dilate);</span><br><span class="line">blurI(:,:,<span class="number">3</span>) = roifilt2(G,I_ori(:,:,<span class="number">3</span>),logBW_dilate);</span><br><span class="line">figure;</span><br><span class="line">imshow(blurI);</span><br><span class="line">title(<span class="string">'gaussian blur on roi'</span>);</span><br><span class="line"></span><br><span class="line">imwrite(blurI, <span class="string">'5_out.png'</span>);</span><br><span class="line"></span><br><span class="line">S = fspecial(<span class="string">'sobel'</span>);          <span class="comment">% ROI 区域进行 sobel 锐化</span></span><br><span class="line">sobelI = blurI;</span><br><span class="line">sobelI(:,:,<span class="number">1</span>) = roifilt2(S, blurI(:,:,<span class="number">1</span>), logBW_dilate);</span><br><span class="line">sobelI(:,:,<span class="number">2</span>) = roifilt2(S, blurI(:,:,<span class="number">2</span>), logBW_dilate);</span><br><span class="line">sobelI(:,:,<span class="number">3</span>) = roifilt2(S, blurI(:,:,<span class="number">3</span>), logBW_dilate);</span><br><span class="line">sobelI = uint8(sobelI) + uint8(blurI);</span><br><span class="line">title(<span class="string">'sobel sharpen on roi of blurI'</span>);</span><br></pre></td></tr></table></figure>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/04/27/2019-周报11/" data-id="cjv0msf94000g6ou73b9pd3u5" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/04/27/2019-周报11/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/04/27/2019-周报11/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报10" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/04/12/2019-周报10/">2019-周报10</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/04/12/2019-周报10/">
            <time datetime="2019-04-12T13:41:11.000Z" itemprop="datePublished">2019-04-12</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deeplearning/">deeplearning</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周继续学习了CycleGAN，重点学习并总结了深度学习中常用的各种卷积之间的区别与联系。调试修复了视频编解码中的部分bug，完成了双路同步编解码的功能。</p>
<h1 id="1-视频编解码项目现状说明"><a href="#1-视频编解码项目现状说明" class="headerlink" title="1 视频编解码项目现状说明"></a>1 视频编解码项目现状说明</h1><p>测试发现，现在编码解码部分虽然都使用GPU完成，但是中间拼接部分却是在CPU中进行的，整个过程的内存使用情况如下</p>
<p><img src="/2019/04/12/2019-周报10/week10-CodecMemoryV1.png" alt="图1.CodecMemoryV1.png"></p>
<p>所以拼接部分目前实际是在内存中完成，针对此部分的改进方法目前有两种方案</p>
<ul>
<li>ffmpeg + CUDA</li>
<li>ffmpeg + OpenCV</li>
</ul>
<p>使用opencv只能针对<strong>拼接部分</strong>进行改进，即将内存中的帧转移到显存使用GPU拼接，中间有<code>显存-&gt;内存-&gt;显存</code> 的转移过程。</p>
<p>使用ffmpeg + CUDA或许能够完成整个解码，拼接，编码过程均在显卡中完成，目前还未实践。</p>
<h1 id="2-深度学习常用卷积总结"><a href="#2-深度学习常用卷积总结" class="headerlink" title="2 深度学习常用卷积总结"></a>2 深度学习常用卷积总结</h1><p>深度学习在图像领域的操作主要依赖卷积操作，根据不同场景不同目的产生了各种不同的卷积方式。常用的二维卷积，三维卷积，转置卷积，增大感受野的扩张卷积，减小参数的可分卷积，模型并行的分组卷积，以及用于超分辨的亚像素卷积等等，选择不同的卷积对网络的性能，参数都会有很大的影响。</p>
<h4 id="2-1-2DConv-3DConv"><a href="#2-1-2DConv-3DConv" class="headerlink" title="2.1 2DConv, 3DConv"></a>2.1 2DConv, 3DConv</h4><p>使用二维卷积时，卷积核的深度等于被卷积图像的深度，所以卷积时在深度方向不移动，最后卷积的结果为二维特征。而三维卷积时，卷积核的深度小于被卷积图像的深度，所以卷积时除了横向纵向移动之外还会在深度上移动，所以被称为三维卷积，卷积结果为三维特征，如下图所示</p>
<p><img src="/2019/04/12/2019-周报10/week10-3DConv.png" alt=""></p>
<h4 id="2-2-转置卷积"><a href="#2-2-转置卷积" class="headerlink" title="2.2 转置卷积"></a>2.2 转置卷积</h4><p>转置卷积可以当作上面卷积的逆操作，在卷积操作之前通过在周围补零的方式达到卷积之后的size大于卷积之前的size，通常用于上采样。</p>
<p>当卷积核与其转置卷积相乘结果为单位矩阵时，卷积与转置卷积是完全互逆的，但不满足此条件时，卷积与转置卷积不是可逆的。</p>
<h4 id="2-3-扩张卷积-dilated-convolutions"><a href="#2-3-扩张卷积-dilated-convolutions" class="headerlink" title="2.3 扩张卷积 (dilated convolutions)"></a>2.3 扩张卷积 (dilated convolutions)</h4><p>扩张卷积的主要优点是在不增加模型参数的情况下扩大感受野，参数 I(扩张率) 表示希望将核加宽的程度，通常是在核元素之间插入 I-1 个空格实现。当 I=0 时，和普通卷积一样。</p>
<h4 id="2-4-可分卷积"><a href="#2-4-可分卷积" class="headerlink" title="2.4 可分卷积"></a>2.4 可分卷积</h4><p>深度学习中使用的可分卷积通常指深度可分卷积，谷歌提出的MobileNet中便是使用的这种卷积。深度可分卷积主要是在卷积的深度上进行了创新，通过单层卷积与 1x1 卷积将最开始的卷积操作拆成两步进行。</p>
<p>先使用深度为 1 的卷积核进行卷积操作，于是卷积的输入输出拥有相同的深度，再使用 1x1 卷积扩大深度。通过这样的操作减小训练的参数。具体操作方法见参考资料。</p>
<h4 id="2-5-分组卷积"><a href="#2-5-分组卷积" class="headerlink" title="2.5 分组卷积"></a>2.5 分组卷积</h4><p>分组卷积即将卷积操作分组进行，如将 255x255x16 数据分为两组 255x255x8 的数据各自进行卷积操作从而实现模型并行操作。模型并行不仅拥有数据并行的加速功能，因为能够将模型部署在不同GPU中，还能节省显存，从而能够增大训练的batch。分组卷积还能大大减小模型参数，分为 n 组，参数便能减小为原来的 $1/n$ </p>
<p>初此之外，分组卷积甚至能改进模型，上面提到分组卷积能够减小模型参数，因此具有稀疏过滤器的功能，效果类似于dropout。</p>
<h4 id="2-6-亚像素卷积"><a href="#2-6-亚像素卷积" class="headerlink" title="2.6 亚像素卷积"></a>2.6 亚像素卷积</h4><p>在做超分网络时，使用转置卷积上采样会造成棋盘效应，而亚像素卷积能很好地克服棋盘效应。其实现也很简单，就是将很深的低分辨率特征组装成高分辨图像，如下图所示。</p>
<p><img src="/2019/04/12/2019-周报10/week10-subpixConv.png" alt="图3.subpixConv"></p>
<h4 id="2-7-参考资料"><a href="#2-7-参考资料" class="headerlink" title="2.7 参考资料"></a>2.7 参考资料</h4><ul>
<li><a href="https://towardsdatascience.com/a-comprehensive-introduction-to-different-types-of-convolutions-in-deep-learning-669281e58215" target="_blank" rel="noopener">A Comprehensive Introduction to Different Types of Convolutions in Deep Learning</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/04/12/2019-周报10/" data-id="cjv0msf97000l6ou7kt2il15v" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/04/12/2019-周报10/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/04/12/2019-周报10/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报9" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/04/07/2019-周报9/">2019-周报9</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/04/07/2019-周报9/">
            <time datetime="2019-04-07T03:01:34.000Z" itemprop="datePublished">2019-04-07</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deeplearning/">deeplearning</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>以往深度学习模型训练测试大多都是在别人的模型上稍微修改便拿来用，本周开始自己从头构建模型代码进行训练，注意到了很多之前没有注意的实现细节。本周的主要工作有以下两点</p>
<ul>
<li>阅读论文 <em><a href="https://arxiv.org/abs/1412.6572" target="_blank" rel="noopener">Explaining and harnessing adversarial examples</a></em> 学习了对抗样本的相关知识</li>
<li>继续学习 GAN 的相关知识</li>
</ul>
<h1 id="1-对抗样本"><a href="#1-对抗样本" class="headerlink" title="1 对抗样本"></a>1 对抗样本</h1><p>对抗样本一直是机器学习中一个难题，刻意地在样本中加入特定扰动便能大大降低模型的识别准确率，如下图所示，便能使网络将熊猫识别为长臂猿。<img src="/2019/04/07/2019-周报9/week9-FGSM_panda.png" alt="图1.FGSM panda example"></p>
<p>制造对抗样本的方法中最有名的方法之一便是上图中使用的 FGSA(fast gradient sign attack)。一直以来大家都知道对抗样本问题的存在，但是对于引起这种现象的原因却并不明了。现在业界对此的共识是<strong>输入特征维度过高和模型的线性性质导致</strong> 。只要找到特定的方向，图像的每个像素点都朝特定的方向前进一小步，就会导致整个图片的特征发生很大的改变从而跨过决策层。</p>
<h3 id="1-1-对抗样本的防御"><a href="#1-1-对抗样本的防御" class="headerlink" title="1.1 对抗样本的防御"></a>1.1 对抗样本的防御</h3><p>目前对抗样本的生成远比防御更加容易，大多对抗样本的生成都是利用了其梯度信息。最容易想到的防御方法便是将生成的对抗样本一块儿加入训练集中进行训练，这种方法可以有效地防御样本攻击，但是只能针对用于训练的对抗样本有效，除此之外还有<strong>defensive distillation</strong> ，<strong>梯度隐藏</strong> 等方法。但相比攻击来说，防御并没有做得足够好。</p>
<h3 id="1-2-总结"><a href="#1-2-总结" class="headerlink" title="1.2 总结"></a>1.2 总结</h3><p>对抗样本的出现对理解深度学习有很大的帮助，在很多领域深度学习识别率都大大超越了人类水平，但对抗样本的出现算是找到了深度学习的一处盲点，目前还没有很好的方法完全解决这一问题。</p>
<h3 id="1-3-参考资料"><a href="#1-3-参考资料" class="headerlink" title="1.3 参考资料"></a>1.3 参考资料</h3><ul>
<li><p><a href="https://pytorch.org/tutorials/beginner/fgsm_tutorial.html#fast-gradient-sign-attack" target="_blank" rel="noopener">ADVERSARIAL EXAMPLE GENERATION</a></p>
</li>
<li><p><a href="https://arxiv.org/abs/1412.6572" target="_blank" rel="noopener">Explaining and harnessing adversarial examples</a></p>
</li>
<li><p><a href="https://blog.csdn.net/nemoyy/article/details/81052301" target="_blank" rel="noopener">对抗样本：知其然，知其所以然</a></p>
<p>​</p>
</li>
</ul>
<h1 id="2-GAN"><a href="#2-GAN" class="headerlink" title="2 GAN"></a>2 GAN</h1><h3 id="2-1-实践部分"><a href="#2-1-实践部分" class="headerlink" title="2.1 实践部分"></a>2.1 实践部分</h3><p>本周继续学习了GAN的相关知识，在参考了许多经典模型之后开始自己动手编写模型。在自己编写模型的过程中注意到了很多之前忽视的实现上的细节知识，加强了对深度学习框架的熟悉程度。</p>
<p>自己实现模型需要关注的东西更多，从数据的读取，预处理，到网络的构建，优化器的选择，训练，测试的过程。比起在已有的代码中更改网络模型进行训练，手动实现整个过程有助于观察到更多的细节部分。之前已经跑过相应的代码，目前自己从头编写的代码仅实现了一部分，还未全部完成。</p>
<h3 id="2-2-理论部分"><a href="#2-2-理论部分" class="headerlink" title="2.2 理论部分"></a>2.2 理论部分</h3><p>GAN的相关理论发展主要在对真实样本与生成样本之间分布的测量部分，Goodfellow最开始论文中使用的是 <strong>JS-divergence</strong> 来度量分布之间的距离。但这种距离的测量不是很容易，而且两个分布在没有任何交集的情况下距离都相同，也就是距离的远近不影响测量值，这样不利于训练。</p>
<p>在这之后逐渐提出了很多种不同的度量方式，如 <a href="http://papers.nips.cc/paper/6066-f-gan-training-generative-neural-samplers-using-variational-divergence-minimization.pdf" target="_blank" rel="noopener">f-GAN</a>中便进行了推广，利提出了多种不同的测量方式如下<img src="/2019/04/07/2019-周报9/week9-Fdivergence.png" alt="图2.F-divergence"></p>
<p>随后在<strong>W-GAN</strong>中又提出了新的测量方式 <strong>Earth Mover’s distance</strong> 更好得解决了两个分布无任何交集情况下得距离问题，其中的理论知识都挺复杂，一时半会很难搞懂。</p>
<h3 id="2-3-参考资料"><a href="#2-3-参考资料" class="headerlink" title="2.3 参考资料"></a>2.3 参考资料</h3><ul>
<li><p><a href="http://papers.nips.cc/paper/6066-f-gan-training-generative-neural-samplers-using-variational-divergence-minimization.pdf" target="_blank" rel="noopener">f-GAN</a></p>
</li>
<li><p><a href="https://arxiv.org/pdf/1701.07875.pdf" target="_blank" rel="noopener">Wasserstein GAN</a></p>
</li>
<li><p><a href="https://www.bilibili.com/video/av24011528/?p=1" target="_blank" rel="noopener">李宏毅对抗生成网络(GAN)国语教程(2018)</a></p>
<p>​</p>
</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/04/07/2019-周报9/" data-id="cjv0msf8x00096ou744q6yqqx" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/04/07/2019-周报9/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/04/07/2019-周报9/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报8" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/03/29/2019-周报8/">2019-周报8</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/03/29/2019-周报8/">
            <time datetime="2019-03-29T02:01:21.000Z" itemprop="datePublished">2019-03-29</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deeplearning/">deeplearning</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周主要工作如下：</p>
<ul>
<li>总结了深度学习中常用的损失函数</li>
<li>学习了GAN, DCGAN, CGAN, cycleGAN等常用GAN网络</li>
<li>翻译了pytorch官方文档中DCGAN的教程，训练生成人脸图像</li>
<li>继续完善视频编解码代码，发现了新的bug，正在调试中</li>
</ul>
<h1 id="1-常用损失函数"><a href="#1-常用损失函数" class="headerlink" title="1 常用损失函数"></a>1 常用损失函数</h1><p>损失函数的作用是衡量实际输出与预计输出之间的差异，损失函数的设计是深度学习中十分重要的部分，不仅会影响到训练的速度，还会影响隐含层中数据的分布情况。目前仅仅是总结了部分常用损失函数的计算方法，其中涉及很多统计学最优化知识，对此仅仅是浅尝辄止，其中更多的原理还需要以后慢慢总结体会，以下仅简要记录其计算方法。</p>
<h3 id="1-1-MSE"><a href="#1-1-MSE" class="headerlink" title="1.1 MSE"></a>1.1 MSE</h3><p>均方误差算是最简单也是最经典的一种计算损失的方法，其中 $\hat y$ 为实际输出，$y$ 为标签。<br>$$<br>mse_loss =\frac{1}{N} \sum _{i=1} ^N (y_i - \hat y_i)^2<br>$$</p>
<h3 id="1-2-CrossEntropy"><a href="#1-2-CrossEntropy" class="headerlink" title="1.2 CrossEntropy"></a>1.2 CrossEntropy</h3><p>交叉熵是从KL散度中引出，用于衡量两个分布之间差异的大小，其值总是大于等于0，两个分布越相似其值越接近于0。训练时的标签可以当成一种分布，实际输出堪称另一种分布，常与softmax层结合用于分类模型。<br>$$<br>CrossEntropy_loss = -\sum _i y_i·log\hat y_i<br>$$</p>
<h3 id="1-3-log损失函数"><a href="#1-3-log损失函数" class="headerlink" title="1.3 log损失函数"></a>1.3 log损失函数</h3><p>log损失通常用于逻辑回归，是二分类中常用的损失函数，若二分类中使用mse损失会造成最后优化函数为非凹函数，不利于训练。其中 $x$ 表示输出该特征，$y$ 表示所属类别， $p(1/x)$ 表示输入特征 $x$ 属于类别 $1$ 的概率。<br>$$<br>log_loss = \begin{cases}<br>-log(p(1/x)), &amp;&amp;&amp;y=1 \<br>-log(1-p(1/x)),&amp;&amp;&amp;y=0<br>\end{cases}<br>$$<br>将上面分类书写的形式变换一下，便得到了BCE_loss，只不过是换了一个名字而已，效果与上式相同<br>$$<br>BCE_loss = -y·log(p(y/x)) - (1-y)·log(1 - p(y/x))<br>$$<br>逻辑回归是分类网络中基础又重要的一个网络，GAN网络中的discriminator便是使用这种二分类网络。比较GAN网络的损失函数便会发现相似之处<br>$$<br> \mathop{min} \limits_G\mathop{max} \limits_ D V(G,D) = E_{x∼pdata(x)}[logD(x)]+E_{z∼pz(z)}[log(1−D(G(x)))]<br>$$</p>
<h3 id="1-4-Smooth-L1"><a href="#1-4-Smooth-L1" class="headerlink" title="1.4 Smooth L1"></a>1.4 Smooth L1</h3><p>smooth L1是何凯明提出的优化的MSE损失，能有有效地优化梯度爆炸问题。这个例子表明我们可以根据我们网络的具体表现适当调节我们的损失函数从而解决特定的训练问题。<br>$$<br>smooth_l1_loss  = \begin{cases}<br>0.5(x_i - y_i)^2, &amp;&amp;&amp;\mbox{if }&amp;|x_i - y_i|&lt;1 \<br>|x_i - y_i| - 0.5,&amp;&amp;&amp;otherwise<br>\end{cases}<br>$$</p>
<h3 id="1-5-F-divergence"><a href="#1-5-F-divergence" class="headerlink" title="1.5 F-divergence"></a>1.5 F-divergence</h3><p>F-divergence是一个大的类，其中 $F$ 表示特定的函数，当函数 $F$ 不同便表示的不同的散度，上面提到的交叉熵便是 KL散度即 KL-divergence。其中KL使用的 $F$ 为 $t·logt$ 。F-divergence损失函数如下：<br>$$<br>D_f (P_{data}||P_g) = \int_x P_g(x)f(\frac{P_{data}(x)}{P_g(x)})\, dx<br>$$<br>目前还有很多损失函数没有总结，比如用于人脸识别的<a href="https://pytorch.org/docs/stable/nn.html?highlight=loss#torch.nn.TripletMarginLoss" target="_blank" rel="noopener">TripletMarginLoss </a> 比起一般的损失函数能够很好地将不同的人脸特征分开。总之损失函数对深度学习的影响非常重要，很多时候使用一种损失导致训练崩坏而换一种损失便能得到不错的效果。</p>
<h1 id="2-GAN"><a href="#2-GAN" class="headerlink" title="2 GAN"></a>2 GAN</h1><p>作为目前生成网络中的老大，GAN的发展十分迅猛而且应用场景很多，十分有趣。阅读了GAN的论文，翻译了 <a href="https://blog.csdn.net/weixin_36811328/article/details/88420820" target="_blank" rel="noopener">PyTorch教程之DCGAN</a> 并学习CGAN, CycleGAN等优秀的GAN模型。</p>
<p>GAN网络解决了很多之前没能解决的问题，不光对生成网络贡献巨大，也为非监督学习领域带来了重大的突破。在此之前的生成模型领域有一个很难解决的问题便是如何对生成的图像做评估，而GAN使用 discriminator网络来对生成图片做评估很好地解决了这一问题。</p>
<h3 id="2-1-DCGAN"><a href="#2-1-DCGAN" class="headerlink" title="2.1 DCGAN"></a>2.1 DCGAN</h3><p>DCGAN即deep convolution GAN第一次将GAN网络应用到图像处理领域。输入为服从高斯分布的随机噪声，输出目标图像，其主要的改进如下：</p>
<ol>
<li>取消了所有的pooling层，在判别器网络中使用strided convolutions层代替，在生成器中使用fractional-strided convolutions代替</li>
<li>在生成器与判别器中都加入了 batchnorm 层</li>
<li>移除了隐藏层中的全连接层</li>
<li>生成器中所有隐含层中使用ReLU激活函数，输出层使用Tanh激活函数</li>
<li>判别器中激活函数都使用 LeakyReLU </li>
</ol>
<p>DCGAN使得GAN网络在图像处理得到了良好的训练，但是其输入输出并没有建立良好的联系，而很多实际应用中需要将输入 $z$ 与输出图像之间建立联系，而非随机生成。例如输入文字，产生相应图像，输入语言，产生相应的图像，于是CGAN应运而生。</p>
<h3 id="2-2-CGAN"><a href="#2-2-CGAN" class="headerlink" title="2.2 CGAN"></a>2.2 CGAN</h3><p>CGAN即 conditional GANs，在网络中引入了条件信息，使得GAN网络生成的图片能和输入之间联系起来。CGAN的应用场景十分广泛，图像修复，图像匹配………..。其最初的训练步骤如下</p>
<p><img src="/2019/03/29/2019-周报8/week8-cgan.png" alt="图1.CGAN训练结构"></p>
<p>但现在在此基础上有了更多新的结构产生，大多是对生成器与判别器进行改进而来。如上图所示通常来说只有一个判别器，目前新的结构通过引入更多的判别器，一个判断生成的图像是否realistic，另一个判断生成的图像是否match。引入的条件也越来越多，文字，语言，图像等都是常用的条件信息。</p>
<h3 id="2-3-CycleGAN"><a href="#2-3-CycleGAN" class="headerlink" title="2.3 CycleGAN"></a>2.3 CycleGAN</h3><p>CycleGAN的这种环形结构并不新鲜，在之前的AutoEncoder中就有这种类似的结构，CycleGAN将这种环形结构与GAN相结合，更好地解决了对生成后图像的评价问题。</p>
<p><img src="/2019/03/29/2019-周报8/week8-cycleGAN-structure.png" alt="图2.CycleGAN结构"></p>
<p>CGAN的训练需要很多很多成对的数据，通常这是很难获取的，而CycleGAN则完全为非监督学习，不需要成对的数据 (unpaired image-to-image)。这使得更多的训练任务变得可能，特别是在风格转换领域得到了广泛的应用。 </p>
<p>近几年GAN的发展十分迅速，其相关的理论研究也在不断完善。除了通过结构对网络进行优化，还有很多在距离的度量方式上的重大突破，例如 LS-GAN, EB-GAN, WGAN, FisherGAN 等很多网络。这方面的理论知识相对更加复杂。</p>
<h3 id="2-4-参考资料"><a href="#2-4-参考资料" class="headerlink" title="2.4 参考资料"></a>2.4 参考资料</h3><ul>
<li><a href="http://openaccess.thecvf.com/content_ICCV_2017/papers/Zhu_Unpaired_Image-To-Image_Translation_ICCV_2017_paper.pdf" target="_blank" rel="noopener">Unpaired Image-To-Image Translation Using Cycle-Consistent Adversarial Networks</a></li>
<li><a href="https://papers.nips.cc/paper/5423-generative-adversarial-nets.pdf" target="_blank" rel="noopener">Generative Adversarial Nets</a></li>
<li><a href="http://openaccess.thecvf.com/content_cvpr_2017/papers/Isola_Image-To-Image_Translation_With_CVPR_2017_paper.pdf" target="_blank" rel="noopener">Image-to-Image Translation with Conditional Adversarial Networks</a></li>
<li><a href="https://arxiv.org/pdf/1511.06434.pdf" target="_blank" rel="noopener">Unsupervised Representation Learning With Deep Convolutional Generative Adversarial Networks</a></li>
<li><a href="https://www.bilibili.com/video/av24011528/?p=1" target="_blank" rel="noopener">李宏毅对抗生成网络(GAN)国语教程(2018)</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/03/29/2019-周报8/" data-id="cjv0msf8v00086ou7vgy3txru" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/03/29/2019-周报8/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/03/29/2019-周报8/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报7" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/03/22/2019-周报7/">2019-周报7</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/03/22/2019-周报7/">
            <time datetime="2019-03-22T03:25:54.000Z" itemprop="datePublished">2019-03-22</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周解决了之前编码丢帧的问题。将原来测试中的单路解码根据项目需求改为双路解码，但由于ffmpeg的解码方式，可能造成两路解码帧的不同步，便会造成后续拼接部分的错位。总体来说大的主框架已经完成，但还有很多细节的部分需要调试。目前拼接使用的上下分割的拼接方式，隔行拼接计算量更大，且 UV 数据的处理还未找到解决方法。</p>
<p>除此之外阅读了 Geoffrey Hinton 关于模型简化的论文 <a href="http://arxiv.org/pdf/1503.02531" target="_blank" rel="noopener">Distilling the knowledge in a neural network</a> ，论文中使用复杂模型来训练简单模型，使简单模型具有复杂模型的性能，从而达到简化模型结构的目的。</p>
<h1 id="1-视频编解码"><a href="#1-视频编解码" class="headerlink" title="1 视频编解码"></a>1 视频编解码</h1><p>上次实验之所以有丢帧的现象是因为没有没有清洗(flush the decoder/encoder) 编解码器。在解码的时候，将所有编码数据全部送到解码器之后，在结束前需要调用<code>avcodec_send_packet(dec_ctx, NULL)</code>往解码器输入 <code>NULL</code> 将解码器中剩余的帧”冲洗”出来，编码同理。</p>
<h3 id="1-1-双路解码一路编码"><a href="#1-1-双路解码一路编码" class="headerlink" title="1.1 双路解码一路编码"></a>1.1 双路解码一路编码</h3><p>前面说到，<strong>ffmpeg</strong>使用以下四个函数进行编解码：</p>
<ul>
<li><code>avcodec_send_frame</code></li>
<li><code>avcodec_receive_packet</code></li>
<li><code>avcodec_send_packet</code></li>
<li><code>avcodec_receive_frame</code></li>
</ul>
<p>但是这几个函数的使用并不是很有规律地进行。比如<code>avcodec_send_packet</code>与<code>avcodec_receive_frame</code>配合使用完成解码功能。调试发现，两个函数并非严格地交替执行，执行情况根据具体的编码视频不同而不相同。所以在双路解码时不能仅仅通过对以上两个解码函数使用上的同步而达到对解码后帧的同步。实际操作中，通过对两路解码状态的监测实现双路解码的同步。</p>
<h3 id="1-2-编解码工作计划"><a href="#1-2-编解码工作计划" class="headerlink" title="1.2 编解码工作计划"></a>1.2 编解码工作计划</h3><p>基本完成了<code>deepwater.exe inputA inputB output</code>形式的可执行程序的主要内容，内部调用NVIDIA的编解码器进行编解码操作。根据之前的测试结果，奇偶分割或者上下分割两种方式，在未加去隔行处理的情况下表现差异不大，且均达到肉眼不可分的清晰度。但是YUV420P格式在奇偶分割的处理中存在着 UV 分量不可分的情况。</p>
<p>除了以上提到的内容，对项目进一步的工作安排还不是太清楚。</p>
<h1 id="2-提炼模型"><a href="#2-提炼模型" class="headerlink" title="2 提炼模型"></a>2 提炼模型</h1><p>提高模型性能的一个简单方法便是训练多个不同的模型，然后使用多个模型识别的平均值作为最总结果，但是这样会导致预测模型过于笨重，且耗费过多的计算资源。本篇文章通过特殊的训练方法从笨重的模型中提炼信息到简单模型中，从而简化模型。</p>
<h3 id="2-1-实现方法"><a href="#2-1-实现方法" class="headerlink" title="2.1 实现方法"></a>2.1 实现方法</h3><p>本篇文章中提到的训练方法其实比较简单。例如，当我们训练分类模型时使用的标签均为<strong>硬标签(hard targets)，即所属类别处为1，其余为0</strong>。但我们实际训练模型的输出为该输入所属类别的概率(softmax)。</p>
<p>$$<br>q_i = \frac{exp(z_i/T)}{\sum_jexp(z_j/T)}<br>$$</p>
<p>而我们的标签(hard targets) 中却并没有体现出该图片像其它类别的概率，也就是说我们的硬标签中包含的信息不如softmax多。于是作者<strong>使用训练之后复杂模型的输出来作为图片的标签(soft targets) 来训练简单的模型</strong>。最后得出的结果表明，虽然大大简化了模型的结构，却可以得到接近复杂模型的正确率，如下图所示。</p>
<p><img src="/2019/03/22/2019-周报7/week7-disstilled-accury.png" alt=""></p>
<p>除此之外作者还针对不同的模型给出了多种训练方法，可通过调整上式子中的温度指数$T$ 来调节概率的分布情况。且使用不同的目标函数，不同的代价函数也均能使用这种方法来简化模型。使用软标签(soft targets)训练使得训练的速度更快，仅使用原训练数据 3% 的训练量即可达到</p>
<p>接近原模型的测试正确率，具体指标如下图所示。</p>
<p><img src="/2019/03/22/2019-周报7/week7-littledataset.png" alt=""></p>
<h3 id="2-2-总结"><a href="#2-2-总结" class="headerlink" title="2.2 总结"></a>2.2 总结</h3><p>以上方法的核心便是通过对训练集标签的改进，将 hard targets 改进为 soft targets。使得标签能够提供更多的信息，从而可以达到简化模型的目的，在实际部署中非常有用。</p>
<h3 id="2-3-参考文献"><a href="#2-3-参考文献" class="headerlink" title="2.3 参考文献"></a>2.3 参考文献</h3><ul>
<li>Hinton, Geoffrey, Oriol Vinyals, and Jeff Dean. “Distilling the knowledge in a neural network.” arXiv preprint arXiv:1503.02531 (2015). <a href="http://arxiv.org/pdf/1503.02531" target="_blank" rel="noopener">pdf</a> (Godfather’s Work)</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/03/22/2019-周报7/" data-id="cjv0msf96000i6ou73dgvrsw7" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/03/22/2019-周报7/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/03/22/2019-周报7/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报6" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/03/14/2019-周报6/">2019-周报6</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/03/14/2019-周报6/">
            <time datetime="2019-03-14T06:22:36.000Z" itemprop="datePublished">2019-03-14</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>上周实验了opencv 的视频编解码功能，实验与调研结果表明opencv 对视频的编解码支持不够友好。于是决定使用ffmpeg 负责解码与编码工作，opencv 负责对解码后的数据进行处理。</p>
<p>本周在参考<strong>ffmpeg</strong>官方例程的基础上完成了对<strong>H265</strong>视频的解码，处理，再编码的工作。解码使用<strong>hevc-cuvid</strong>解码器，编码使用<strong>hevc-nvenc</strong>编码器，实验过程存在丢帧的现象，目前正在调试中，下面是具体的实验记录。</p>
<h1 id="基于ffmpeg的HEVC编解码实验"><a href="#基于ffmpeg的HEVC编解码实验" class="headerlink" title="基于ffmpeg的HEVC编解码实验"></a>基于ffmpeg的HEVC编解码实验</h1><p>GPU型号：GeForce GTX 1080</p>
<p>CUDA版本：CUDA 9.0</p>
<p>FFmpeg版本：ffmpeg-20180818-de1b44c-win64</p>
<p>IDE：Visual Studio 2015</p>
<p>ffmpeg不同编解码器的使用方法大体相同，使用GPU进行编解码时需要保证已安装好编解码器需要调用的底层环境。比如使用<strong>h264_qsv</strong>编解码器需要安装<strong>Intel Media SDK</strong> ，调用<strong>hevc-nvenc</strong>需要安装CUDA环境以及<strong>NVIDIA CODEC SDK</strong>，下面依次介绍ffmpeg的编解码过程。</p>
<h3 id="解码流程"><a href="#解码流程" class="headerlink" title="解码流程"></a>解码流程</h3><p>解码部分初始化部分相对简单，不需要设置很多复杂得参数，只需要完成相应数据的内存分配，并正确指定解码器的种类便可。</p>
<p>ffmepg按帧进行解码，我们的实验中每次读取4096 Byte送进解析器<code>av_parser_parse2()</code>，解析器会自动解析出一帧压缩的数据。配合使用<code>avcodec_send_packet(dec_ctx, pkt)</code>与<code>avcodec_receive_frame(dec_ctx, frame)</code> 来解压一帧数据，下图为解压流程。</p>
<p><img src="/2019/03/14/2019-周报6/week6-decode.png" alt="图一.解码流程"></p>
<p>解压完一帧数据便存储于<strong>ffmpeg</strong>自定义的数据结构 <strong>frame</strong> 中，我们可以将此帧数据转换为<strong>opencv</strong>中的 <strong>MAT</strong> 类型并调用<strong>opencv</strong>中的相应函数进行处理，再将处理完成之后的数据转为<strong>ffmepg</strong>的<strong>frame</strong>数据进行编码。</p>
<h3 id="编码流程"><a href="#编码流程" class="headerlink" title="编码流程"></a>编码流程</h3><p>相对于解码而言，编码需要设置更多的参数，更多的是对编码器的配置。且不同的编码器对应的配置存在一些差别。比如，使用<strong>hevc_nvenc</strong> 编码时 <strong>max_b_frames</strong> 参数必须设置为 <strong>0</strong>，否则会导致编码器加载失败</p>
<p><img src="/2019/03/14/2019-周报6/week6-LoadError.png" alt="图2.加载失败"></p>
<p>在调试过程中，设置 <code>av_log_set_level(64);</code> 可以得到很多重要的提示信息，非常有利于找到问题的原因。</p>
<p>编码器的其它参数设置如下：</p>
<ul>
<li>c-&gt;bit_rate = 400000;</li>
<li>c-&gt;width = 1920;</li>
<li>c-&gt;high = 1080;</li>
<li>c-&gt;time_base = (AVRational) {1, 25};</li>
<li>c-&gt;framerate = (AVRational) {25, 1};</li>
<li>c-&gt;max_b_frames = 0;</li>
<li>c-&gt;pix_fmt = <a href="http://ffmpeg.org/doxygen/trunk/pixfmt_8h.html#a9a8e335cf3be472042bc9f0cf80cd4c5a1aa7677092740d8def31655b5d7f0cc2" target="_blank" rel="noopener">AV_PIX_FMT_NV20LE </a>;</li>
</ul>
<p>上面可以看出，我们设置的像素存储格式不是 <strong>AV_PIX_FMT_YUV420P</strong> ，那是因为调试的过程中发现使用<strong>hevc-cuvid</strong>后的数据格式为 <strong>AV_PIX_FMT_NV20LE</strong>  ，这也是YUV420P的一种，只是在ffmpeg中数据的存储方法上有些变化。</p>
<p>编码流程总的来说于解码类似，使用<a href="http://ffmpeg.org/doxygen/trunk/group__lavc__decoding.html#ga9395cb802a5febf1f00df31497779169" target="_blank" rel="noopener">avcodec_send_frame</a>(enc_ctx, frame) 发送一帧数据到编码器，再配合使用<a href="http://ffmpeg.org/doxygen/trunk/group__lavc__decoding.html#ga5b8eff59cf259747cf0b31563e38ded6" target="_blank" rel="noopener">avcodec_receive_packet</a>(enc_ctx, pkt) 接收编码后的数据。</p>
<h3 id="整体流程"><a href="#整体流程" class="headerlink" title="整体流程"></a>整体流程</h3><p>整体流程即将上面的编解码流程结合，再加上对解码后得到的每帧图像进行处理。在完成对编解码的调试后，这个过程中最主要的便是对解码后数据的处理。现在主要的问题便是想整个过程都在GPU中进行处理，避免时间浪费在数据的转移过程中。目前了解到的信息是，opencv中的数据处理可以全程在gpu中进行，但ffmpeg到opencv数据类型的转换过程还没有深入了解。</p>
<p><img src="/2019/03/14/2019-周报6/week6-overall-process.png" alt="图3.整体流程"></p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://www.cnblogs.com/betterwgo/p/6843390.html" target="_blank" rel="noopener">ffmpeg nvenc编码</a></li>
<li><a href="https://www.ffmpeg.org/doxygen/4.1/examples.html" target="_blank" rel="noopener">FFmpeg Example</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/03/14/2019-周报6/" data-id="cjv0msf91000b6ou7yo37o218" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/03/14/2019-周报6/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/03/14/2019-周报6/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报5" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/03/08/2019-周报5/">2019-周报5</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/03/08/2019-周报5/">
            <time datetime="2019-03-08T08:57:49.000Z" itemprop="datePublished">2019-03-08</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周测试了OpenCV使用GPU对视频的读写显示情况，结果显示仅使用OpenCV不能很好地完成视频编码工作，综合考虑可以使用 OpenCV + FFmpeg 的方法各自完成其擅长的工作。搭建了ffmpeg + opencv 的开发环境学习了ffmpeg 最新的编解码相关API。</p>
<h1 id="1-OpenCV的硬编解码测试"><a href="#1-OpenCV的硬编解码测试" class="headerlink" title="1 OpenCV的硬编解码测试"></a>1 OpenCV的硬编解码测试</h1><p>OpenCV 的软编解码是在在ffmpeg 的基础上实现的，能够支持几乎所有视频的解码，H264 及之前的编码。OpenCV 硬编解码则是跳过ffmpeg 直接在NVIDIA 官方的编解码包Video Codec SDK 上实现的，所以硬编解码方面仅支持NVIDIA的显卡。</p>
<p>之前提到，opencv在视频编解码方面支持得不是很好，在硬编解码方面则更加脆弱，对底层环境得版本及其依赖，以下是试验得过程记录。</p>
<h3 id="1-1-使用OpenGL进行显示"><a href="#1-1-使用OpenGL进行显示" class="headerlink" title="1.1 使用OpenGL进行显示"></a>1.1 使用OpenGL进行显示</h3><p>在代码调试过程中为了实时显示视频，查看编解码效果，使用OpenGL 进行加速显示，opencv 中使用OpenGL需要单独编译。要使opencv支持OpenGL，首先得安装QT 环境，使用QT中的OpenGL模块，并在使用CMake-GUI 时勾选 <code>with_opengl = ON</code> <code>with_qt = ON</code>。</p>
<p>但是QT官方提供的windows安装包只有32位的，并没有64位的。而若要编译支持CUDA 的opencv 必须编译 64 位得opencv，刚开始没有注意到这一点浪费了很多时间。所以在Windows环境下，如果要编译同时支持OpenGL和CUDA的opencv就必须下载QT源码编译安装64位的QT环境，再按照以下路径选择设置即可完成安装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Set QT_MAKE_EXECUTABLE to D:\Qt\5.9\mingw53_32\bin\qmake.exe</span><br><span class="line">Set Qt5Concurrent_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5Concurrent</span><br><span class="line">Set Qt5Core_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5Core</span><br><span class="line">Set Qt5Gui_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5Gui</span><br><span class="line">Set Qt5Test_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5Test</span><br><span class="line">Set Qt5Widgets_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5Widgets</span><br><span class="line">Set Qt5OpenGL_DIR to D:\Qt\5.9\mingw53_32\lib\cmake\Qt5OpenGL</span><br></pre></td></tr></table></figure>
<h3 id="1-2-解码"><a href="#1-2-解码" class="headerlink" title="1.2 解码"></a>1.2 解码</h3><p>使用<code>cv::cudacodec::createVideoReader(fname)</code> 进行硬解码，解码后的数据直接存储在GPU中进行处理。但实际上这个语句的兼容性极差，前面提到opencv的硬编解码直接在NVIDIA 官方的编解码包Video Codec SDK 上实现的，这块基本属于opencv的边缘部分，很少人使用，官方针对这部分的更新也很缓慢，每当 Video Codec SDK 有了更新就很可能导致各种 Segmentation fault 。比如在使用<code>cv::cudacodec::createVideoReader(fname)</code>解码数据前，必须调用以下 Video Codec SDK 的函数进行初始化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">void* hHandleDriver = 0;</span><br><span class="line">CUresult res = cuInit(0, __CUDA_API_VERSION, hHandleDriver);</span><br><span class="line">if (res != CUDA_SUCCESS) &#123;</span><br><span class="line">    throw exception();</span><br><span class="line">&#125;</span><br><span class="line">res = cuvidInit(0);</span><br><span class="line">if (res != CUDA_SUCCESS) &#123;</span><br><span class="line">    throw exception();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而opencv没有对此进行任何封装，且比较依赖当前的CUDA版本，在 CUDA8.0 时支持较好(网上调查论坛结果，没有实践，实验室电脑CUDA版本为9.0)。</p>
<p>使用opencv封装之后的解码函数硬解码有各种意外发生，但使用NVIDIA 官方提供的编解码例程直接调用 Video Codec SDK 能正常完成编解码。可以排除底层环境导致的原因，相关问题在 opencv 的GitHub库中的issue中也有较多的讨论。</p>
<h3 id="1-3-编码"><a href="#1-3-编码" class="headerlink" title="1.3 编码"></a>1.3 编码</h3><p>硬解码部分的支持不是很完善，硬编码部分代码更不完善，目前只支持windows平台，且不支持HEVC的编码。</p>
<h3 id="1-4-总结"><a href="#1-4-总结" class="headerlink" title="1.4 总结"></a>1.4 总结</h3><p>目前为止在opencv中能够实现的有以下部分：</p>
<ul>
<li>H264,H265的cpu解码</li>
<li>复制解码后的数据到GPU，在GPU完成拼接工作</li>
<li>H264的软编码</li>
</ul>
<p>CUDA9.0中默认的Video Codec SDK版本使用<code>dynlink_nvcuvid.h</code>代替了<code>nvcuvid.h</code> 导致 opencv中的硬解码出现段错误，目前试验了很多方法还没有解决问题，应该可以通过单独更新 Video Codec SDK到最新的 8.1 版本解决，但为了不影响计算机中的整体环境还没有实际操作。H264,H265的硬解码理论上也是可以实现的（没有实际）。</p>
<h3 id="1-5-参考资料"><a href="#1-5-参考资料" class="headerlink" title="1.5 参考资料"></a>1.5 参考资料</h3><ul>
<li><a href="https://wiki.qt.io/How_to_setup_Qt_and_openCV_on_Windows" target="_blank" rel="noopener">How to setup Qt and openCV on Windows</a></li>
<li><a href="https://devtalk.nvidia.com/default/topic/1046924/other-tools/problem-in-executing-cv-cudacodec/" target="_blank" rel="noopener">Problem in executing cv::cudacodec</a></li>
<li><a href="http://answers.opencv.org/question/178227/cvcudacodeccreatevideoreader-segfault/" target="_blank" rel="noopener">cv::cudacodec::createVideoReader segfault</a></li>
<li><a href="https://github.com/opencv/opencv/issues/10201" target="_blank" rel="noopener">‘Segmentation fault’ with gpu video decoding</a></li>
<li><a href="https://docs.opencv.org/3.4/db/ded/classcv_1_1cudacodec_1_1VideoReader.html" target="_blank" rel="noopener">cv::cudacodec::VideoReader Class Reference</a></li>
<li><a href="https://docs.opencv.org/3.4/da/d2c/tutorial_table_of_content_gpu.html" target="_blank" rel="noopener">GPU-Accelerated Computer Vision (cuda module)</a></li>
</ul>
<h1 id="2-ffmpeg中的数据结构"><a href="#2-ffmpeg中的数据结构" class="headerlink" title="2 ffmpeg中的数据结构"></a>2 ffmpeg中的数据结构</h1><p>学习一个框架从他的数据结构入手可以很清晰地了解框架的操作对象，更好地把握数据处理过程，ffmpeg使用 C 语言构建，其中的数据结构均由结构体描述，目前为止已经有超过两千种的数据结构，下面是ffmpeg编解码常用的各种结构体，涉及到网络协议，封装格式，解码器信息，视频数据等重要的存储结构。</p>
<h3 id="2-1-AVFormatContext"><a href="#2-1-AVFormatContext" class="headerlink" title="2.1 AVFormatContext"></a>2.1 AVFormatContext</h3><p>AVFormatContext可以说是贯穿ffmpeg始终的结构体，也是包含信息最多的一个结构体。包含了输入数据缓存，视音频流，视音频流个数，文件名，视频时长，比特率，元数据等重要信息。下面介绍的很多结构均是此结构体中的子结构。</p>
<h3 id="2-2-AVIOContext"><a href="#2-2-AVIOContext" class="headerlink" title="2.2 AVIOContext"></a>2.2 AVIOContext</h3><p>AVIOContext包含于AVFormatContext中，看名字便可知道主要和文件输入输出有关。主要包含了缓存开始的位置，缓存大小，当前指针读取位置，缓存结束位置，使用的网络协议等。</p>
<h3 id="2-3-编解码器信息"><a href="#2-3-编解码器信息" class="headerlink" title="2.3 编解码器信息"></a>2.3 编解码器信息</h3><p><strong>AVCodecContext</strong>是其中复杂度很高的结构体，其中包含了很多编解码的具体属性，如编解码器的类型（视频或音频），具体的编解码器，平均码率，帧率，采样格式等等。</p>
<p><strong>AVCodec</strong>包含于AVCodecContext中，存储着具体使用的编解码器信息。</p>
<h3 id="2-4-AVPacket"><a href="#2-4-AVPacket" class="headerlink" title="2.4 AVPacket"></a>2.4 AVPacket</h3><p>AVPacket主要存储了解码前的一帧数据，相对来说比较简单，除此之外还存储了数据的大小，时间戳等信息。</p>
<h3 id="2-5-AVFrame"><a href="#2-5-AVFrame" class="headerlink" title="2.5 AVFrame"></a>2.5 AVFrame</h3><p>AVFrame主要存储了解码后的一帧数据以及该帧数据的相关信息，类如是否为关键帧，原始数据类型，视频的宽，高等。</p>
<h3 id="2-6-相关结构的关系"><a href="#2-6-相关结构的关系" class="headerlink" title="2.6 相关结构的关系"></a>2.6 相关结构的关系</h3><p>下图来自<a href="https://blog.csdn.net/leixiaohua1020" target="_blank" rel="noopener">雷霄骅</a>雷神的博客，清晰地表示以上结构体之间的依赖关系</p>
<p><img src="/2019/03/08/2019-周报5/./week5-ffmpeg-structure.png" alt="图1.ffmpeg重要结构体关系"></p>
<h3 id="2-7-参考资料"><a href="#2-7-参考资料" class="headerlink" title="2.7 参考资料"></a>2.7 参考资料</h3><ul>
<li><a href="https://blog.csdn.net/leixiaohua1020/article/details/11693997" target="_blank" rel="noopener">FFMPEG中最关键的结构体之间的关系</a></li>
<li><a href="https://blog.csdn.net/u013699869/article/details/46238337#commentBox" target="_blank" rel="noopener">demuxing_decoding.cpp 在VS下调试错误总结</a></li>
<li><a href="http://ffmpeg.org/doxygen/trunk/annotated.html" target="_blank" rel="noopener">FFmpeg Data Structures</a></li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/03/08/2019-周报5/" data-id="cjv0msf8u00056ou7n24qypck" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/03/08/2019-周报5/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/03/08/2019-周报5/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报4" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/03/01/2019-周报4/">2019-周报4</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/03/01/2019-周报4/">
            <time datetime="2019-03-01T05:58:28.000Z" itemprop="datePublished">2019-03-01</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周编译了支持GPU的opencv源码（编译时间挺长的），并分别测试了使用H264，H265编码的视频读写情况。除此之外翻译了一篇pytorch官方的教程。</p>
<h1 id="1-OpenCV读写H264-H265编码视频"><a href="#1-OpenCV读写H264-H265编码视频" class="headerlink" title="1 OpenCV读写H264,H265编码视频"></a>1 OpenCV读写H264,H265编码视频</h1><p>测试了opencv读，写，拼接 H264，H265视频，下面是详细过程与结果。</p>
<h3 id="1-1-读取H264，H265编码视频"><a href="#1-1-读取H264，H265编码视频" class="headerlink" title="1.1 读取H264，H265编码视频"></a>1.1 读取H264，H265编码视频</h3><p>分别使用opencv中的<code>cv::VideoCapture(source)</code> 读取 H264，H265编码后的视频，读取H264的视频一切正常，读取H265的视频整体正常，但提示丢失帧：</p>
<p><img src="/2019/03/01/2019-周报4/./week4-h265-read.png" alt="图1.h265-read"></p>
<p>使用100帧H265编码视频测试发现读取正常，并没有少帧。所以，读取部分没有问题。</p>
<p>测试还发现，使用<code>cv::VideoCapture(source)</code> 读取的视频都是在cpu中进行解码处理。且解码后的帧为 BGR 数据，而不是YUV420，但并不影响后续拼接操作。</p>
<h3 id="1-2-拼接"><a href="#1-2-拼接" class="headerlink" title="1.2 拼接"></a>1.2 拼接</h3><p>视频读取后便可很容易地获取每一帧，拼接部分只需要对每一帧进行操作即可。 BGR 数据反而解决了 UV 数据不可分的问题。</p>
<h3 id="1-3-写视频"><a href="#1-3-写视频" class="headerlink" title="1.3 写视频"></a>1.3 写视频</h3><p>在视频写入之前的操作都没有什么大的问题，视频写入使用 <code>cv::VideoWriter Class</code> 进行操作。该类可以通过 <code>VideoWriter::fourcc(&#39;H&#39;, &#39;E&#39;, &#39;V&#39;, &#39;C&#39;)</code>选择编码方式。</p>
<p>当我们选择 H264 （<code>VideoWriter::fourcc(&#39;X&#39;, &#39;2&#39;, &#39;6&#39;, &#39;4&#39;)</code>）编码时，提示信息如下：</p>
<p><img src="/2019/03/01/2019-周报4/week4-h264-write.png" alt="图2.opencv-h264-write"></p>
<p>提示缺少 <code>openh264-1.6.0-win64msvc.dll</code> 文件，OpenCV默认情况下没有编译此文件，可通过下载 <a href="https://github.com/cisco/openh264/releases/tag/v1.6.0" target="_blank" rel="noopener">openh264-1.6.0-win64msvc.dll.bz2</a>  文件解决此问题。</p>
<p>当我们选择 H265 编码时，提示信息如下：</p>
<p><img src="/2019/03/01/2019-周报4/week4-h265-write.png" alt="图3.opencv-h265-write"></p>
<p>表示根本找不到此编码方式，opencv目前还不支持 H265 编码。官方论坛上此问题也没得到解决<a href="http://answers.opencv.org/question/200752/could-i-use-videowriter-to-save-the-video-as-h265hevc-format/" target="_blank" rel="noopener">官方论坛相关问题</a>  </p>
<p>实验表明 OpenCV 虽然支持 H264,265的解码，但是对编码的支持不够友好，官方文档对此问题专门做出了说明，如下：</p>
<p><img src="/2019/03/01/2019-周报4/week4-The-structure-of-a-video.png" alt="图4.The structure of a video"></p>
<h3 id="1-4-GPU解决方案"><a href="#1-4-GPU解决方案" class="headerlink" title="1.4 GPU解决方案"></a>1.4 GPU解决方案</h3><p>以上操作均是在CPU中处理实现，在查询并阅读opencv官方文档之后发现</p>
<ul>
<li><code>cv::cudacodec::VideoReader Class</code> </li>
<li><code>cv::cudacodec::VideoWriter Class</code></li>
<li><code>cv::cuda::GpuMat Class</code></li>
</ul>
<p>等GPU中的视频读写，帧操作方法。但是资料较少，暂时还没有使用代码实现相应的功能，具体编解码支持情况还没调查清楚。</p>
<h3 id="1-5-总结"><a href="#1-5-总结" class="headerlink" title="1.5 总结"></a>1.5 总结</h3><p>实验表明，解码，拼接 部分，在 cpu 中能够正常完成。并且容易推测，在GPU中也能完成 解码，拼接部分任务。目前问题主要出在编码部分，视频编码不是OpenCV的主要关注点，目前仅能支持 H264的编码。</p>
<h3 id="1-6-参考资料"><a href="#1-6-参考资料" class="headerlink" title="1.6 参考资料"></a>1.6 参考资料</h3><ul>
<li><a href="https://docs.opencv.org/3.4/d0/da7/videoio_overview.html" target="_blank" rel="noopener">Video I/O with OpenCV Overview</a></li>
</ul>
<ul>
<li><a href="https://docs.opencv.org/master/d5/dc4/tutorial_video_input_psnr_ssim.html" target="_blank" rel="noopener">Video Input with OpenCV and similarity measurement</a></li>
<li><a href="https://docs.opencv.org/3.4.5/d7/d9e/tutorial_video_write.html" target="_blank" rel="noopener">Creating a video with OpenCV</a></li>
<li><a href="https://docs.opencv.org/3.4.5/dd/d9e/classcv_1_1VideoWriter.html" target="_blank" rel="noopener">cv::VideoWriter Class Reference</a></li>
<li><a href="http://www.fourcc.org/codecs.php" target="_blank" rel="noopener">Video Codecs by FOURCC</a></li>
<li><a href="https://docs.opencv.org/3.4/db/ded/classcv_1_1cudacodec_1_1VideoReader.html" target="_blank" rel="noopener">cv::cudacodec::VideoReader Class Reference</a></li>
<li><a href="https://docs.opencv.org/3.3.0/d0/d60/classcv_1_1cuda_1_1GpuMat.html" target="_blank" rel="noopener">cv::cuda::GpuMat Class Reference</a></li>
<li><a href="https://docs.opencv.org/master/dd/d3d/tutorial_gpu_basics_similarity.html" target="_blank" rel="noopener">Similarity check (PNSR and SSIM) on the GPU</a></li>
<li><a href="https://docs.opencv.org/3.4.0/df/dde/classcv_1_1cudacodec_1_1VideoWriter.html#a6318b8266c824bd17081940a7930b18e" target="_blank" rel="noopener">cv::cudacodec::VideoWriter Class Reference</a></li>
</ul>
<h1 id="2-pytorch官方资料翻译"><a href="#2-pytorch官方资料翻译" class="headerlink" title="2 pytorch官方资料翻译"></a>2 pytorch官方资料翻译</h1><p><a href="https://blog.csdn.net/weixin_36811328/article/details/87905208" target="_blank" rel="noopener">深入理解TORCH.NN</a></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/03/01/2019-周报4/" data-id="cjv0msf8r00036ou7bsdakwrt" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/03/01/2019-周报4/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/03/01/2019-周报4/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报3" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/02/22/2019-周报3/">2019-周报3</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/02/22/2019-周报3/">
            <time datetime="2019-02-22T14:53:57.000Z" itemprop="datePublished">2019-02-22</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>开学以来主要学习了CUDA优化相关的内容，创建了VS2015的cuda工程熟悉其编程与调试过程。人脸识别方面，调研了目前开源的人脸识别数据集，阅读了VGGFace与VGGFace2两篇论文，下载了Visual Geometry Group在2018年公布的VGGFace2 数据集并跑了一些主流的人脸识别模型。</p>
<h1 id="1-CUDA-程序的优化"><a href="#1-CUDA-程序的优化" class="headerlink" title="1 CUDA 程序的优化"></a>1 CUDA 程序的优化</h1><p>CUDA编程中，优化是非常关键的一步，算法的好坏极大地影响到程序的运行效率，优化的关键主要在于其执行模型与内存模型。执行模型中，线程束的调度，SIMD(单指令多数据)的理解，线程块大小个数的分配标准。内存模型中，全局内存，共享内存，缓存，常量内存的区别与使用方法以及各种内存与线程之间的关系。</p>
<h2 id="1-1-执行模型"><a href="#1-1-执行模型" class="headerlink" title="1.1 执行模型"></a>1.1 执行模型</h2><p>弄懂执行模型就是要知道成千上万的线程是如何在GPU中调度的，从硬件层面探讨内核的执行问题，首先要了解以下GPU硬件中的概念：</p>
<ul>
<li>cuda核</li>
<li>线程束(warp)</li>
<li>SIMD(single instruction multi data)</li>
<li>SM(stream multi processer)</li>
</ul>
<h4 id="1-1-1-cuda核"><a href="#1-1-1-cuda核" class="headerlink" title="1.1.1 cuda核"></a>1.1.1 cuda核</h4><p>cuda核是为了适应GPU的大规模运算专门精简设计的算术逻辑单元(ALU)，我们程序设计的线程便是在cuda核中计算处理。</p>
<h4 id="1-1-2-线程束-warp"><a href="#1-1-2-线程束-warp" class="headerlink" title="1.1.2 线程束(warp)"></a>1.1.2 线程束(warp)</h4><p>线程束是一个重要的概念，每个线程束包含32个线程，32是cuda编程的一个重要数字。线程的执行都是按照线程束调度的而不是单个线程调度。</p>
<h4 id="1-1-3-单指令多数据-SIMD"><a href="#1-1-3-单指令多数据-SIMD" class="headerlink" title="1.1.3 单指令多数据(SIMD)"></a>1.1.3 单指令多数据(SIMD)</h4><p>前面讲到线程束之所以重要，就是(SIMD)架构决定的。顾名思义，单指令多数据，就是多个(32个)数据同时执行一个指令。也就是一个线程束（warp）中的32个线程同时执行一条指令（或者某些线程等待不执行任何操作，这样会浪费资源，需要优化），这也是考虑到并行处理时大量的重复指令设计的。</p>
<h4 id="1-1-4-流式多处理器-SM"><a href="#1-1-4-流式多处理器-SM" class="headerlink" title="1.1.4 流式多处理器(SM)"></a>1.1.4 流式多处理器(SM)</h4><p>流式多处理器（SM）是GPU架构的核心，一个SM由大量的cuda核，特殊功能单元，加载/存储单元组成。一个SM可以管理上千个线程束（不同型号GPU不同），SM个数便是常说的GPU核心数。</p>
<h4 id="1-1-5-相互关系"><a href="#1-1-5-相互关系" class="headerlink" title="1.1.5 相互关系"></a>1.1.5 相互关系</h4><p>以上几个概念的关系可以简单描述为：32个cuda核组成一个线程束，同一个线程束（32个cuda核）执行相同的指令即为SIMD(一个warp中的32个线程执行相同的指令)，多个（不同型号GPU数目不同）warp组成一个SM，一块GPU包含多个SM (SM的个数便是常说的GPU核心数)。下图较好得描述了逻辑视图和硬件视图：</p>
<p><img src="/2019/02/22/2019-周报3/week3-CudaHardwareUnit.png" alt="图1.硬件结构"></p>
<p>在了解了gpu的执行模型之后，将编程模型与执行模型结合，便能很好得理解block,grid的设计原则，以及block中线程的数量与性能之间的关系，是算法优化的一大因素。</p>
<h2 id="1-2-内存模型"><a href="#1-2-内存模型" class="headerlink" title="1.2 内存模型"></a>1.2 内存模型</h2><p>GPU中的内存主要分为两个部分，<strong>全局内存</strong>与<strong>共享内存</strong>，全局内存通过PCIE总线与CPU相连，可以直接通过CPU操作，即我们通常说的显存，容量大，速度相对较慢。共享内存只能在GPU内分配使用，即二级缓存，容量有限，速度快。共享内存是珍贵的资源，共享内存与全局内存的不同使用方法都会极大得影响到程序的性能，对于读写频繁的数据，转移到共享内存再操作会极大地提高运行速度。</p>
<h4 id="1-2-1-常用内存"><a href="#1-2-1-常用内存" class="headerlink" title="1.2.1 常用内存"></a>1.2.1 常用内存</h4><p>下面是常用内存地存取速度：</p>
<ul>
<li>Register – dedicated HW – single cycle </li>
<li>Shared Memory – dedicated HW – single cycle </li>
<li>Local Memory – DRAM, no cache –  slow</li>
<li>Global Memory – DRAM, no cache – slow</li>
<li>Constant Memory – DRAM, cached – depending on cache locality</li>
<li>Texture Memory – DRAM, cached –  depending on cache locality</li>
<li>Instruction Memory ( invisible ) – DRAM </li>
</ul>
<p>实用关键字 <code>__shared__</code>在共享内存中创建变量，关键字<code>__device__</code>在全局内存中创建变量，以下是常用的变量声明方式</p>
<table>
<thead>
<tr>
<th>变量声明</th>
<th>存储器</th>
<th>作用域</th>
<th>生命期</th>
</tr>
</thead>
<tbody>
<tr>
<td>单独声明的自动变量（非数组）</td>
<td>register</td>
<td>thread</td>
<td>kernel</td>
</tr>
<tr>
<td>自动变量数组</td>
<td>local</td>
<td>thread</td>
<td>kernel</td>
</tr>
<tr>
<td><code>__shared__ int sharedVar</code></td>
<td>shared</td>
<td>block</td>
<td>kernel</td>
</tr>
<tr>
<td><code>__device__ int sharedVar</code></td>
<td>global</td>
<td>grid</td>
<td>application</td>
</tr>
<tr>
<td><code>__constant__ int sharedVar</code></td>
<td>constant</td>
<td>grid</td>
<td>application</td>
</tr>
</tbody>
</table>
<h4 id="1-2-2-内存与线程的关系"><a href="#1-2-2-内存与线程的关系" class="headerlink" title="1.2.2 内存与线程的关系"></a>1.2.2 内存与线程的关系</h4><p>每个线程私有的为 Local Memory，local memory存储于全局内存中。共享内存（shared memory）为每个block共享，不同block之间不能相互访问。全局内存为整个设备共有。</p>
<h2 id="1-3-参考资料"><a href="#1-3-参考资料" class="headerlink" title="1.3 参考资料"></a>1.3 参考资料</h2><ul>
<li>CUDA C权威编程指南</li>
<li><a href="https://www.bilibili.com/video/av10436982" target="_blank" rel="noopener">NVIDIA Fellow 周斌博士视频讲解</a></li>
</ul>
<h1 id="2-人脸识别"><a href="#2-人脸识别" class="headerlink" title="2 人脸识别"></a>2 人脸识别</h1><p>本次仅仅是训练的人脸识别，不包括人脸检测，使用的数据集也都是经过人脸检测切割之后的人脸图像。</p>
<h2 id="2-1-人脸识别数据集介绍"><a href="#2-1-人脸识别数据集介绍" class="headerlink" title="2.1 人脸识别数据集介绍"></a>2.1 人脸识别数据集介绍</h2><p>深度学习在人脸识别领域取得了巨大的成功，但在2015年之前，都没有一个适用于深度学习的人脸识别开源数据集，比较大的超过百万张图片的数据集例如Google，Facebook的数据库都是公司私有并不公开。传统的人脸识别数据库如 LFW(Labelled Faces in the Wild)，数据量都很有限。由于制作数据集成本高昂，所以人脸识别在学术届的发展较为缓慢，直到2015年牛津大学Visual Geometry Group实验室公布了VGGFace人脸识别数据集才得已改善，我们使用的是Visual Geometry Group实验室在2018年发布的VGGFace2数据集进行训练，下面是一些人脸识别数据集的介绍。</p>
<p><img src="/2019/02/22/2019-周报3/week3-FaceDataSet.png" alt=""></p>
<h2 id="2-2-参考资料"><a href="#2-2-参考资料" class="headerlink" title="2.2 参考资料"></a>2.2 参考资料</h2><ol>
<li>ZQ. Cao, L. Shen, W. Xie, O. M. Parkhi, A. Zisserman, VGGFace2: A dataset for recognising faces across pose and age, 2018.   <a href="https://www.robots.ox.ac.uk/~vgg/data/vgg_face2/" target="_blank" rel="noopener">site</a>, <a href="https://arxiv.org/abs/1710.08092" target="_blank" rel="noopener">arXiv</a></li>
<li>Parkhi, O. M. and Vedaldi, A. and Zisserman, A., Deep Face Recognition, British Machine Vision Conference, 2015.<a href="http://www.robots.ox.ac.uk/~vgg/software/vgg_face/" target="_blank" rel="noopener">site</a></li>
<li>K. Zhang and Z. Zhang and Z. Li and Y. Qiao, Joint Face Detection and Alignment Using Multitask Cascaded Convolutional Networks, IEEE Signal Processing Letters, 2016. <a href="https://arxiv.org/abs/1604.02878" target="_blank" rel="noopener">arXiv</a></li>
</ol>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/02/22/2019-周报3/" data-id="cjv0msf8t00046ou7m2qtk4i4" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/02/22/2019-周报3/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/02/22/2019-周报3/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <article id="post-2019-周报2" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2019/01/31/2019-周报2/">2019-周报2</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fas fa-calendar-alt"></i>
        <a href="/2019/01/31/2019-周报2/">
            <time datetime="2019-01-31T14:53:57.000Z" itemprop="datePublished">2019-01-31</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/deepwater/">deepwater</a>
    </div>

                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>本周主要学习了cuda编程，简单地了解了几种基于深度学习的人脸识别算法(DeepFace, DeepID, FaceNet, VGGFace)</p>
<h1 id="1-CUDA编程"><a href="#1-CUDA编程" class="headerlink" title="1 CUDA编程"></a>1 CUDA编程</h1><p>CPU+GPU的异构编程架构是高性能计算的主流，以高吞吐量与高效率完成复杂任务。其代码分为两部分，由主机端(CPU)运行代码与设备端(GPU)运行代码(核函数)组成。</p>
<p>CUDA编程中，<strong>内存管理</strong>，<strong>线程管理</strong>，<strong>设备管理</strong>是非常重要的概念，也是构成程序逻辑与影响程序效率的重要因素。除此之外CUDA编程需要了解GPU的架构，资源。CUDA程序流程大致分为以下几个部分：</p>
<ol>
<li>主机端(CPU)内存分配，设备端(GPU)内存分配</li>
<li>把数据从CPU内存拷贝到GPU内存</li>
<li>调用核函数对存储在GPU内存的数据进行操作</li>
<li>将数据从GPU内存传回到CPU内存</li>
</ol>
<h3 id="1-1-内存管理"><a href="#1-1-内存管理" class="headerlink" title="1.1 内存管理"></a>1.1 内存管理</h3><p>CUDA编程模型是由主机和设备组成，各自拥有独立的内存。为了使操作者拥有充分的控制权并使系统达到最佳性能，CUDA运行时负责分配与释放内存，并且在主机与设备内存之间传输数据。内存管理函数如下：</p>
<p><img src="/2019/01/31/2019-周报2/./week2-memory.png" alt="图一.内存管理函数"></p>
<p>设备端的内存只有核函数能够读取，使用<code>udaMemcpy()</code>函数在主机与设备之间进行数据转移，如上面的4个步骤提到的，通常都是将主机端的数据拷贝到设备端，调用核函数对设备端的数据进行计算，再将计算之后的结果拷贝回主机端进行存储。</p>
<h3 id="1-2-线程管理"><a href="#1-2-线程管理" class="headerlink" title="1.2 线程管理"></a>1.2 线程管理</h3><p>线程管理是CUDA编程很重要的一个概念，从逻辑层的角度来看，GPU中各个线程并行进行（硬件层不一定都是并行）。CUDA的特点之一就是通过编程模型揭示了一个两层线程层次结构（grid+block），充分熟悉与理解线程层次结构对DUDA编程十分重要。</p>
<p>每启动一个核函数就会在设备中产生大量的线程，并且每个线程都执行由核函数指定的语句，产生的大量线程便是两层的线程结构进行管理，由线程块(block)与线程网格(grid)构成</p>
<p><img src="/2019/01/31/2019-周报2/./week2-thread_level.png" alt="图二.线程结构"></p>
<p>每启动一个核函数，就同时启动了一个网格(grid)，网格最多可以为三维，维度值的最大值由硬件决定，我们服务器上的 GeForce GTX 1080 Ti 支持的最大网格维数为<code>1D=(131072), 2D=(131072,65536), 3D=(16384,16384,16384)</code> ，网格由块组成，这便是线程结构的第一层。块由线程组成，这便是第二层。他们的层次结构为: 网格(grid)–&gt;块(block)–&gt;线程(thread)</p>
<h3 id="1-3-设备管理"><a href="#1-3-设备管理" class="headerlink" title="1.3 设备管理"></a>1.3 设备管理</h3><p>前面说到了在逻辑层来说，各个线程都是并行运行的，但是在硬件层并不一定，并没有那么多的硬件资源供所有线程并行运行。设备管理需要清楚当前硬件的资源情况，对于程序的优化十分重要，设备管理需要对GPU的架构有一定了解，NVIDIA目前推出的最新架构为Turing，实验室服务器使用的 GeForce GTX 1080 Ti为Pascal架构，其资源如下图所示：</p>
<p><img src="/2019/01/31/2019-周报2/./week2-device.png" alt="图3.设备资源"></p>
<p>参数中</p>
<ul>
<li>Warp size:                                     32</li>
<li>Maximum number of threads per multiprocessor:  2048</li>
<li>Maximum number of threads per block:           1024</li>
<li>Maximum sizes of each dimension of a block:    1024 x 1024 x 64</li>
<li>Maximum sizes of each dimension of a grid:     2147483647 x 65535 x 65535</li>
</ul>
<p>几个参数，对于编程时资源的分配十分重要</p>
<h3 id="1-4-参考资料"><a href="#1-4-参考资料" class="headerlink" title="1.4 参考资料"></a>1.4 参考资料</h3><ul>
<li>CUDA C编程权威指南(John Cheng)</li>
</ul>
<h1 id="2-基于深度学习的人脸识别算法"><a href="#2-基于深度学习的人脸识别算法" class="headerlink" title="2 基于深度学习的人脸识别算法"></a>2 基于深度学习的人脸识别算法</h1><p>深度学习的人脸识别算法准确度大大地高于传统算法，准确度早已超过了人工识别准确率(DeepFace: 92.5%, DeepID:  99.15%, FaceNet-NN3: 99.65% , LFW数据集测试结果)，所以现在深度学习在人脸识别方面的研究除了提高准确率之外还致力于裁剪网络结构，减小参数(VGGFace)</p>
<h3 id="2-1-DeepFace"><a href="#2-1-DeepFace" class="headerlink" title="2.1 DeepFace"></a>2.1 DeepFace</h3><p>人脸识别可分为 detect-&gt; align-&gt; represent-&gt; classify 几个部分,DeepFace在align部分使用了3D对齐技术，将检测到的人脸进行3D-aligned处理之后再放入网络中进行识别。网络结构如下图所示</p>
<p><img src="/2019/01/31/2019-周报2/./week2-DeepFaceArchitecture.png" alt="图4.DeepFace网络结构"></p>
<p>从图中可以看出，检测到的是侧脸，经过3D-aligned处理之后面部调整为正面，讲调整后的图像输入网络。网络C1, C3表示卷积层，M2为max pooling层，L4, L5, L6为局部卷积层，F7, F8为全连接层。</p>
<h3 id="2-2-DeepID"><a href="#2-2-DeepID" class="headerlink" title="2.2 DeepID"></a>2.2 DeepID</h3><p>DeepID是在GoogleNet和VGGNet上的基础上进行改进，使之适应于人脸识别，网络有一代和二代两种，两种网络的区别主要在于损失函数的定义。常用的为DeepID2的损失函数，除了采用softmax训练构建分类器时产生的交叉熵函数之外，还添加了关于两张图片是不是一个人的损失函数，两个损失函数按权重组合，最终生成了对应的总损失函数用来进行训练，网络结构如下：</p>
<p><img src="/2019/01/31/2019-周报2/./week2-DeepIDArchitecture.png" alt="图5.DeepID网络机构"></p>
<p>相比DeepFace，DeepID3的网络结构更深，且没有使用3D对齐技术，直接输入检测到的人脸图像进行识别。</p>
<h3 id="2-3-FaceNet"><a href="#2-3-FaceNet" class="headerlink" title="2.3 FaceNet"></a>2.3 FaceNet</h3><p>FaceNetFaceNet是谷歌提出的网络结构, 网络在使用的过程中通过三元对来构造损失函数，直接根据学习到的特征向量，计算在一类的图片距离和不在一类的图片距离，训练的结果是一类之间的距离尽量小，不一类之间的距离尽量大。</p>
<h3 id="2-4-VGGFace"><a href="#2-4-VGGFace" class="headerlink" title="2.4 VGGFace"></a>2.4 VGGFace</h3><p>VGGFace的网络在LFW数据集上的准确率为98.95%，虽然不及FaceID和FaceNet，但是网络结构更加简单，有更强的鲁棒性</p>
<h3 id="2-5-参考资料"><a href="#2-5-参考资料" class="headerlink" title="2.5 参考资料"></a>2.5 参考资料</h3><ul>
<li><a href="https://www.cs.toronto.edu/~ranzato/publications/taigman_cvpr14.pdf" target="_blank" rel="noopener">DeepFace: Closing the Gap to Human-Level Performance in Face Verification</a> [Yaniv Taigman et al., 2014]</li>
<li><a href="https://arxiv.org/abs/1502.00873" target="_blank" rel="noopener">DeepID3: Face Recognition with Very Deep Neural Networks</a> [Yi Sun et al., 2015]</li>
<li><a href="http://www.cv-foundation.org/openaccess/content_cvpr_2015/html/Schroff_FaceNet_A_Unified_2015_CVPR_paper.html" target="_blank" rel="noopener">FaceNet: A Unified Embedding for Face Recognition and Clustering</a> [Florian Schroff et al., 2015]</li>
<li><a href="https://www.robots.ox.ac.uk/~vgg/publications/2015/Parkhi15/parkhi15.pdf" target="_blank" rel="noopener">Deep Face Recognition</a> [Omkar M. Parkhi et al., 2015]</li>
</ul>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://yoursite.com/2019/01/31/2019-周报2/" data-id="cjv0msf93000d6ou75ajw3cf0" class="article-share-link"><i class="fas fa-share"></i>Share</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fab fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fab fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fab fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fab fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://yoursite.com/2019/01/31/2019-周报2/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://yoursite.com/2019/01/31/2019-周报2/">Comments</a>
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">recent</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/04/27/2019-周报11/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/04/27/2019-周报11/" class="title">2019-周报11</a></p>
                            <p class="item-date"><time datetime="2019-04-27T10:51:27.000Z" itemprop="datePublished">2019-04-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/04/12/2019-周报10/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/04/12/2019-周报10/" class="title">2019-周报10</a></p>
                            <p class="item-date"><time datetime="2019-04-12T13:41:11.000Z" itemprop="datePublished">2019-04-12</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/04/07/2019-周报9/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/04/07/2019-周报9/" class="title">2019-周报9</a></p>
                            <p class="item-date"><time datetime="2019-04-07T03:01:34.000Z" itemprop="datePublished">2019-04-07</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/03/29/2019-周报8/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/03/29/2019-周报8/" class="title">2019-周报8</a></p>
                            <p class="item-date"><time datetime="2019-03-29T02:01:21.000Z" itemprop="datePublished">2019-03-29</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2019/03/22/2019-周报7/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/03/22/2019-周报7/" class="title">2019-周报7</a></p>
                            <p class="item-date"><time datetime="2019-03-22T03:25:54.000Z" itemprop="datePublished">2019-03-22</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

    
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ImageProcessing/">ImageProcessing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deeplearning/">deeplearning</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/deepwater/">deepwater</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/report/">report</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/ImageProcessing/" style="font-size: 10px;">ImageProcessing</a> <a href="/tags/deeplearning/" style="font-size: 15px;">deeplearning</a> <a href="/tags/deepwater/" style="font-size: 20px;">deepwater</a> <a href="/tags/report/" style="font-size: 10px;">report</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fas fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2019 lee<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
        this.page.identifier = '';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'lilei-blog' + '.disqus.com/count.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>